<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Why Back2Back · UnfoldDecode.jl</title><meta name="title" content="Why Back2Back · UnfoldDecode.jl"/><meta property="og:title" content="Why Back2Back · UnfoldDecode.jl"/><meta property="twitter:title" content="Why Back2Back · UnfoldDecode.jl"/><meta name="description" content="Documentation for UnfoldDecode.jl."/><meta property="og:description" content="Documentation for UnfoldDecode.jl."/><meta property="twitter:description" content="Documentation for UnfoldDecode.jl."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">UnfoldDecode.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><span class="tocitem">tutorials</span><ul><li><a class="tocitem" href="../../tutorials/overlapcorrectedLDA/">Overlap corrected LDA</a></li></ul></li><li><span class="tocitem">HowTo</span><ul><li><a class="tocitem" href="../../HowTo/overlapcorrectedLDA_options/">Overlap corrected, multi-event, many options, LDA</a></li></ul></li><li><span class="tocitem">BackToBack</span><ul><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/b2b_quickstart/">Quick Start b2b</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-2" type="checkbox" checked/><label class="tocitem" for="menuitem-4-2"><span class="docs-label">Explanations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Why Back2Back</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#Data-generation"><span>Data generation</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../reference/b2b_algorithms/">Algorithm choice</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">BackToBack</a></li><li><a class="is-disabled">Explanations</a></li><li class="is-active"><a href>Why Back2Back</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Why Back2Back</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/unfoldtoolbox/UnfoldDecode.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/unfoldtoolbox/UnfoldDecode.jl/blob/main/docs/literate/explanations/b2b_why.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><pre><code class="language- hljs">using Unfold
using UnfoldMakie, CairoMakie
using UnfoldSim
using UnfoldDecode
using DataFrames
using Statistics
include(&quot;../../example_rename_events.jl&quot;)</code></pre><h1 id="explainer-b2b"><a class="docs-heading-anchor" href="#explainer-b2b">Motivation for BacktoBack</a><a id="explainer-b2b-1"></a><a class="docs-heading-anchor-permalink" href="#explainer-b2b" title="Permalink"></a></h1><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>“Back-to-Back” regression (B2B) is an approach to estimate the decoding performance from a set of correlated factors. Why do we need this? Let&#39;s have a look at a simple example: <img src="pic/dog_and_cat.png" alt="My Image"/></p><p>Imagine we record EEG data from an eyetracking experiment, and investigate each fixation (a resting period of the eye) as an event for an ERP. Imagine, we have both cats and dogs, but that we also make large and small eye-movements.</p><h2 id="Data-generation"><a class="docs-heading-anchor" href="#Data-generation">Data generation</a><a id="Data-generation-1"></a><a class="docs-heading-anchor-permalink" href="#Data-generation" title="Permalink"></a></h2><h4 id="Simulation-and-data-collection"><a class="docs-heading-anchor" href="#Simulation-and-data-collection">Simulation and data collection</a><a id="Simulation-and-data-collection-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation-and-data-collection" title="Permalink"></a></h4><p>Collect the data genarated by UnfoldSim, and add certian level of noise</p><pre><code class="language- hljs">dat, evts = UnfoldSim.predef_eeg(; noiselevel = 0.1, return_epoched = true);
evts = example_rename_events(evts)</code></pre><h4 id="Data-further-generating"><a class="docs-heading-anchor" href="#Data-further-generating">Data further generating</a><a id="Data-further-generating-1"></a><a class="docs-heading-anchor-permalink" href="#Data-further-generating" title="Permalink"></a></h4><p>To make the example more impressive, let&#39;s add an orthogonal variable <code>vegetable</code>. But this variable is special: It is correlated with the covariate <code>eye_movement_size</code>.</p><pre><code class="language- hljs">evts.vegetable .=
    [&quot;tomato&quot;, &quot;carrot&quot;][1 .+ (evts.eye_movement_size.+10 .* rand(size(evts, 1)).&gt;7.5)];
cor(evts.eye_movement_size, evts.vegetable .== &quot;carrot&quot;)</code></pre><p><img src="pic/dog_and_cat_and_vegetable.png" alt="My Image"/></p><p>Summarized, we have three independent variables: <code>animal</code>, <code>eye_movement_size</code>, and <code>vegetable</code>, with the latter two being correlated.</p><div class="admonition is-category-important"><header class="admonition-header">Important</header><div class="admonition-body"><p>By construction, there is no <code>vegetable</code> effect in the data! All effects we find for vegetable solely come from the correlation with <code>eye_movement_size</code> - Now imagine decoding vegetable, you would find a strong <strong>spurious</strong> effect.</p></div></div><h4 id="Making-it-multi-channel"><a class="docs-heading-anchor" href="#Making-it-multi-channel">Making it multi channel</a><a id="Making-it-multi-channel-1"></a><a class="docs-heading-anchor-permalink" href="#Making-it-multi-channel" title="Permalink"></a></h4><p>Decoding is multivariate, so we need multiple channels. For simplicity, we just repeat the data 20 times, representing 20 channels.</p><pre><code class="language-julia hljs">dat_3d = permutedims(repeat(dat, 1, 1, 20), [3 1 2]);
dat_3d .+= 0.1 * rand(size(dat_3d)...);</code></pre><h4 id="Solver-selection"><a class="docs-heading-anchor" href="#Solver-selection">Solver selection</a><a id="Solver-selection-1"></a><a class="docs-heading-anchor-permalink" href="#Solver-selection" title="Permalink"></a></h4><pre><code class="language-julia hljs">b2b_solver = (x, y) -&gt; UnfoldDecode.solver_b2b(x, y; cross_val_reps = 5);</code></pre><h4 id="Fitting-function"><a class="docs-heading-anchor" href="#Fitting-function">Fitting function</a><a id="Fitting-function-1"></a><a class="docs-heading-anchor-permalink" href="#Fitting-function" title="Permalink"></a></h4><p>Because we want to compare different scenarios involving different variables, we define a function to estimate them.</p><pre><code class="language-julia hljs">function run_b2b(f)
    # Define a design dictionary according to the formula
    times = range(0, 0.44, step = 1 / 100)
    designDict = [Any =&gt; (f, times)]
    # Fit the model
    m = Unfold.fit(UnfoldModel, designDict, evts, dat_3d; solver = b2b_solver)

    results = coeftable(m)
    results.estimate = abs.(results.estimate)
    results = results[results.coefname.!=&quot;(Intercept)&quot;, :]
    results.formula .= string(f)
    return results
end;</code></pre><p>let&#39;s run a decoder without accounting for the other factors</p><pre><code class="language- hljs">results_all = map(
    run_b2b,
    [
        @formula(0 ~ 1 + animal),
        @formula(0 ~ 1 + vegetable),
        @formula(0 ~ 1 + eye_movement_size)
    ],
)
plot_erp(vcat(results_all...); axis = (xlabel = &quot;Time [s]&quot;, ylabel = &quot;Performance&quot;))</code></pre><p>As one can see, all three variables can be decoded well. <strong>Even though vegetable had no effect on the data!!</strong></p><p>Let&#39;s now use B2B to take into account the correlation between <code>vegetable</code> and <code>eye_movement_size</code>:</p><pre><code class="language- hljs">results_all = map(
    run_b2b,
    [@formula(0 ~ 1 + vegetable), @formula(0 ~ 1 + vegetable + eye_movement_size)],
)
plot_erp(
    vcat(results_all...);
    mapping = (; color = :coefname, row = :formula),
    axis = (xlabel = &quot;Time [s]&quot;, ylabel = &quot;Performance&quot;),
)</code></pre><p>As can be seen, when modelling both effects (lower plot), the vegetable effect (correctly and as intended) vanishes. We now learned, that decodable information is only in  <code>eye_movement_size</code>, but not <code>vegetable</code>, which is &quot;just&quot; correlated</p><p>For completeness sake, we also include the comparison to a non-correlated effect</p><pre><code class="language- hljs">results_all = map(
    run_b2b,
    [@formula(0 ~ 1 + animal), @formula(0 ~ 1 + animal + vegetable + eye_movement_size)],
)
plot_erp(
    vcat(results_all...);
    mapping = (; color = :coefname, row = :formula),
    axis = (xlabel = &quot;Time [s]&quot;, ylabel = &quot;Performance&quot;),
)</code></pre><p>the animal effect remains untouched :)</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../tutorials/b2b_quickstart/">« Quick Start b2b</a><a class="docs-footer-nextpage" href="../../reference/b2b_algorithms/">Algorithm choice »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Wednesday 2 April 2025 08:21">Wednesday 2 April 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
